import { el, svg } from 'redom';
import Track from './Track';
import TrackManager from './TrackManager';

export default class PlayerBar {
    private playerBar: HTMLElement;

    private currentTrack: Track | null = null;
    private playBtnEl: HTMLElement;
    private progressBarEl: HTMLElement;
    private currentTimeEl: HTMLElement;

    constructor(title: string, artist: string, img: string | null, duration: number) {
        const imgEl = el('img.player-bar__img', { src: img, alt: 'Изображение аудиофайла' });
        const titleEl = el('a.player-bar__title', title, { href: '#' });
        const favBtnEl = el('button.player-bar__fav-btn.btn-icon', svg('svg.player-bar__fav-icon', {
            'aria-hidden': true,
            width: '24',
            height: '24',
            viewBox: '0 0 24 24',
            fill: 'none',
            xmlns: 'http://www.w3.org/2000/svg',
        }, [
            svg('path', {
                d: 'M16.5022 3.00001C15.6291 2.99851 14.7677 3.20077 13.9865 3.59072C13.2052 3.98066 12.5258 4.54752 12.0022 5.24621C11.293 4.30266 10.3051 3.606 9.17823 3.25482C8.05134 2.90365 6.84256 2.91573 5.72291 3.28936C4.60327 3.663 3.62948 4.37926 2.93932 5.3368C2.24916 6.29434 1.8776 7.44467 1.8772 8.62501C1.8772 15.3621 11.2373 20.6813 11.6357 20.9044C11.7477 20.9671 11.8739 21 12.0022 21C12.1305 21 12.2567 20.9671 12.3687 20.9044C14.0902 19.8961 15.7059 18.7173 17.1914 17.3856C20.4665 14.438 22.1272 11.4905 22.1272 8.62501C22.1255 7.13368 21.5323 5.70393 20.4778 4.6494C19.4233 3.59487 17.9935 3.0017 16.5022 3.00001Z',
                fill: 'currentColor'
            })
        ]));
        const titleWrapperEl = el('.player-bar__title-wrapper', titleEl, favBtnEl);
        const artistEl = el('a.player-bar__artist', artist, { href: '#' });
        const textWrapper = el('.player-bar__text-wrapper', titleWrapperEl, artistEl);
        const leftEl = el('.player-bar__left', imgEl, textWrapper);
        const shuffleBtnEl = el('button.player-bar__shuffle-btn.btn-icon', svg('svg.player-bar__icon', {
            'aria-hidden': true,
            width: '16',
            height: '16',
            viewBox: '0 0 16 16',
            fill: 'none',
            xmlns: 'http://www.w3.org/2000/svg',
        }, [
            svg('path', {
                d: 'M14.9946 11.4307C14.9933 11.4211 14.9922 11.4116 14.9903 11.4021C14.9887 11.3943 14.9866 11.3867 14.9846 11.379C14.9826 11.3709 14.9808 11.3627 14.9784 11.3546C14.9761 11.3471 14.9732 11.3398 14.9706 11.3324C14.9678 11.3244 14.9651 11.3163 14.9618 11.3084C14.959 11.3017 14.9557 11.2952 14.9526 11.2886C14.9488 11.2804 14.9451 11.2721 14.9408 11.264C14.9375 11.258 14.9338 11.2522 14.9303 11.2463C14.9255 11.2382 14.9209 11.23 14.9156 11.2221C14.9114 11.2159 14.9068 11.2101 14.9024 11.2041C14.8972 11.197 14.8921 11.1897 14.8864 11.1828C14.8792 11.174 14.8713 11.1657 14.8635 11.1574C14.8601 11.1538 14.8571 11.1499 14.8536 11.1464L13.3536 9.64642C13.3071 9.59999 13.252 9.56316 13.1914 9.53803C13.1307 9.5129 13.0657 9.49997 13 9.49997C12.9343 9.49997 12.8693 9.5129 12.8086 9.53803C12.748 9.56316 12.6929 9.59999 12.6464 9.64642C12.6 9.69285 12.5632 9.74798 12.538 9.80865C12.5129 9.86931 12.5 9.93433 12.5 10C12.5 10.0657 12.5129 10.1307 12.538 10.1914C12.5632 10.252 12.6 10.3071 12.6464 10.3536L13.2929 11H12.5585C12.0015 10.9994 11.4526 10.8662 10.9573 10.6113C10.462 10.3565 10.0346 9.98729 9.71039 9.53436L7.10333 5.88446C6.68649 5.30212 6.13693 4.82744 5.50015 4.49974C4.86337 4.17203 4.15769 4.00072 3.44153 4H2C1.86739 4 1.74021 4.05268 1.64645 4.14645C1.55268 4.24021 1.5 4.36739 1.5 4.5C1.5 4.63261 1.55268 4.75979 1.64645 4.85355C1.74021 4.94732 1.86739 5 2 5H3.44153C3.99854 5.00056 4.5474 5.13379 5.04268 5.38866C5.53795 5.64353 5.96539 6.01271 6.28961 6.46564L8.89667 10.1155C9.31351 10.6979 9.86307 11.1726 10.4999 11.5003C11.1366 11.828 11.8423 11.9993 12.5585 12H13.2929L12.6464 12.6464C12.5526 12.7402 12.5 12.8674 12.5 13C12.5 13.1326 12.5526 13.2598 12.6464 13.3536C12.7402 13.4474 12.8674 13.5 13 13.5C13.1326 13.5 13.2598 13.4474 13.3536 13.3536L14.8536 11.8536C14.8571 11.8501 14.8601 11.8462 14.8635 11.8426C14.8713 11.8343 14.8792 11.826 14.8864 11.8172C14.8921 11.8103 14.8972 11.803 14.9024 11.7959C14.9068 11.7899 14.9114 11.7841 14.9156 11.7779C14.9209 11.77 14.9255 11.7618 14.9303 11.7537C14.9338 11.7478 14.9375 11.742 14.9408 11.736C14.9451 11.7279 14.9488 11.7196 14.9526 11.7114C14.9557 11.7048 14.959 11.6983 14.9618 11.6916C14.9651 11.6837 14.9678 11.6756 14.9706 11.6676C14.9732 11.6602 14.9761 11.6529 14.9784 11.6454C14.9808 11.6373 14.9826 11.6291 14.9846 11.621C14.9866 11.6133 14.9887 11.6057 14.9903 11.5979C14.9922 11.5884 14.9933 11.5789 14.9946 11.5693C14.9955 11.5627 14.9968 11.5562 14.9975 11.5495C15.0008 11.5166 15.0008 11.4834 14.9975 11.4505C14.9968 11.4438 14.9955 11.4373 14.9946 11.4307Z',
                fill: 'currentColor',
            }),
            svg('path', {
                d: 'M8.93842 6.68632C8.99184 6.7245 9.05226 6.75179 9.11623 6.76661C9.1802 6.78144 9.24647 6.78351 9.31124 6.77271C9.37601 6.76191 9.43802 6.73846 9.49372 6.70368C9.54942 6.66891 9.59772 6.6235 9.63587 6.57004L9.71045 6.46561C10.0347 6.01269 10.4621 5.64351 10.9574 5.38863C11.4527 5.13376 12.0015 5.00053 12.5585 4.99997H13.2929L12.6465 5.6464C12.5527 5.74017 12.5 5.86736 12.5 5.99997C12.5 6.13259 12.5527 6.25978 12.6465 6.35355C12.7403 6.44733 12.8674 6.50001 13.0001 6.50001C13.1327 6.50001 13.2599 6.44733 13.3536 6.35355L14.8536 4.85355C14.8572 4.85003 14.8602 4.84618 14.8636 4.84258C14.8714 4.83428 14.8792 4.82599 14.8865 4.81717C14.8922 4.81025 14.8972 4.80298 14.9025 4.79583C14.9069 4.78985 14.9115 4.78408 14.9157 4.7779C14.921 4.76999 14.9256 4.76179 14.9304 4.75364C14.9339 4.74775 14.9376 4.74201 14.9408 4.73595C14.9452 4.72788 14.9489 4.71957 14.9527 4.71134C14.9558 4.70475 14.9591 4.69829 14.9619 4.69155C14.9652 4.68364 14.9678 4.67557 14.9707 4.66753C14.9733 4.66014 14.9761 4.65287 14.9784 4.64533C14.9809 4.63727 14.9827 4.62909 14.9847 4.62094C14.9866 4.61325 14.9888 4.60569 14.9904 4.59786C14.9922 4.5884 14.9934 4.57883 14.9947 4.56929C14.9956 4.56267 14.9969 4.55617 14.9976 4.54947C15.0008 4.51655 15.0008 4.48339 14.9976 4.45047C14.9969 4.44377 14.9956 4.43727 14.9947 4.43065C14.9934 4.42112 14.9922 4.41155 14.9904 4.40209C14.9888 4.39426 14.9866 4.38669 14.9847 4.379C14.9827 4.37085 14.9809 4.36268 14.9784 4.35462C14.9761 4.34708 14.9733 4.3398 14.9707 4.33242C14.9678 4.32438 14.9652 4.3163 14.9619 4.3084C14.9591 4.30166 14.9558 4.2952 14.9527 4.28861C14.9489 4.28037 14.9452 4.27207 14.9408 4.264C14.9376 4.25794 14.9339 4.2522 14.9304 4.24631C14.9256 4.23816 14.921 4.22995 14.9157 4.22205C14.9115 4.21587 14.9069 4.2101 14.9025 4.20412C14.8972 4.19696 14.8922 4.1897 14.8865 4.18277C14.8792 4.17395 14.8714 4.16567 14.8636 4.15737C14.8602 4.15377 14.8572 4.14992 14.8536 4.1464L13.3536 2.6464C13.2599 2.55262 13.1327 2.49994 13.0001 2.49994C12.8674 2.49994 12.7403 2.55262 12.6465 2.6464C12.5527 2.74017 12.5 2.86736 12.5 2.99997C12.5 3.13259 12.5527 3.25977 12.6465 3.35355L13.2929 3.99997H12.5585C11.8424 4.0007 11.1367 4.17201 10.4999 4.49971C9.86313 4.82741 9.31357 5.30209 8.89673 5.88444L8.82215 5.98887C8.78398 6.04229 8.75671 6.10272 8.74189 6.16668C8.72708 6.23065 8.72501 6.29691 8.73581 6.36168C8.74661 6.42644 8.77006 6.48845 8.80482 6.54415C8.83958 6.59985 8.88498 6.64816 8.93842 6.68632Z',
                fill: 'currentColor'
            }),
            svg('path', {
                d: 'M7.06165 9.31365C7.00822 9.27547 6.9478 9.24818 6.88383 9.23336C6.81986 9.21854 6.7536 9.21646 6.68883 9.22726C6.62405 9.23806 6.56205 9.26152 6.50634 9.29629C6.45064 9.33107 6.40234 9.37648 6.3642 9.42993L6.28961 9.53436C5.96539 9.98728 5.53795 10.3565 5.04268 10.6113C4.5474 10.8662 3.99854 10.9994 3.44153 11H2C1.86739 11 1.74021 11.0527 1.64645 11.1464C1.55268 11.2402 1.5 11.3674 1.5 11.5C1.5 11.6326 1.55268 11.7598 1.64645 11.8535C1.74021 11.9473 1.86739 12 2 12H3.44153C4.15769 11.9993 4.86337 11.828 5.50015 11.5003C6.13693 11.1726 6.68649 10.6979 7.10333 10.1155L7.17792 10.0111C7.21609 9.95768 7.24336 9.89725 7.25817 9.83329C7.27298 9.76932 7.27505 9.70306 7.26425 9.63829C7.25346 9.57353 7.23001 9.51152 7.19524 9.45582C7.16048 9.40012 7.11508 9.35181 7.06165 9.31365Z',
                fill: 'currentColor'
            })
        ]), { type: 'button' });
        const skipBackBtnEl = el('button.player-bar__skip-back-btn.btn-icon', svg('svg.player-bar__icon', {
            'aria-hidden': true,
            width: '16',
            height: '16',
            viewBox: '0 0 16 16',
            xmlns: 'http://www.w3.org/2000/svg',
        }, [
            svg('path', {
                d: 'M3.5 2C3.63261 2 3.75978 2.05268 3.85355 2.14645C3.94732 2.24022 4 2.36739 4 2.5V7.10846L11.4786 2.53821C11.6302 2.44558 11.8037 2.39501 11.9813 2.39169C12.1589 2.38838 12.3342 2.43244 12.4892 2.51934C12.6441 2.60624 12.7731 2.73285 12.8629 2.88615C12.9527 3.03944 13 3.21389 13 3.39154V12.6085C12.9999 12.7861 12.9526 12.9605 12.8628 13.1137C12.773 13.267 12.644 13.3936 12.489 13.4805C12.3341 13.5674 12.1588 13.6114 11.9812 13.6081C11.8036 13.6048 11.6301 13.5543 11.4785 13.4618L4 8.89151V13.5C4 13.6326 3.94732 13.7598 3.85355 13.8536C3.75979 13.9473 3.63261 14 3.5 14C3.36739 14 3.24021 13.9473 3.14645 13.8536C3.05268 13.7598 3 13.6326 3 13.5V2.5C3 2.36739 3.05268 2.24022 3.14645 2.14645C3.24022 2.05268 3.36739 2 3.5 2Z',
                fill: 'currentColor'
            })
        ]), { type: 'button' });
        // const playBtnEl = el('button.player-bar__play-btn.btn-icon', svg('svg.player-bar__play-icon', {
        //     'aria-hidden': true,
        //     width: '40',
        //     height: '40',
        //     viewBox: '0 0 40 40',
        //     xmlns: 'http://www.w3.org/2000/svg',
        // }, [
        //     svg('rect', {
        //         width: '40',
        //         height: '40',
        //         rx: '20',
        //         fill: 'currentColor',
        //     }),
        //     svg('path.player-bar__play-icon-el', {
        //         d: 'M27.0385 21.4138C26.9679 21.4862 26.7012 21.7962 26.4528 22.0512C24.9963 23.655 21.197 26.28 19.2085 27.0813C18.9065 27.21 18.143 27.4825 17.735 27.5C17.3441 27.5 16.9715 27.41 16.6159 27.2275C16.1727 26.9725 15.8171 26.5713 15.6223 26.0975C15.4968 25.7688 15.302 24.785 15.302 24.7675C15.1072 23.6913 15 21.9425 15 20.01C15 18.1688 15.1072 16.4913 15.2667 15.3988C15.2849 15.3812 15.4798 14.1588 15.6929 13.74C16.0838 12.975 16.8473 12.5 17.6644 12.5H17.735C18.2672 12.5187 19.3863 12.9938 19.3863 13.0113C21.2677 13.8138 24.9793 16.31 26.471 17.9688C26.471 17.9688 26.8911 18.395 27.0738 18.6613C27.3587 19.0437 27.5 19.5175 27.5 19.9913C27.5 20.52 27.3405 21.0125 27.0385 21.4138Z',
        //         fill: 'currentColor'
        //     })
        // ]),
        //     svg('svg.player-bar__pause-icon', {
        //         'aria-hidden': true,
        //         width: '40',
        //         height: '40',
        //         viewBox: '0 0 40 40',
        //         fill: 'currentColor',
        //         xmlns: 'http://www.w3.org/2000/svg',
        //     }, svg('svg.player-bar__pause-icon-el.player-bar__icon-hidden', [
        //         svg('rect', {
        //             width: '40',
        //             height: '40',
        //             rx: '20',
        //             fill: 'red',
        //         }),
        //         svg('rect', {
        //             x: '10',
        //             y: '10',
        //             width: '5',
        //             height: '20',
        //             rx: '2'
        //         }),
        //         svg('rect', {
        //             x: '25',
        //             y: '10',
        //             width: '5',
        //             height: '20',
        //             rx: '2'
        //         })]
        //     )),
        //     { type: 'button' });

        const playBtnEl = el('button.player-bar__play-btn.btn-icon',
            svg('svg.player-bar__play-icon', {
                'aria-hidden': true,
                width: '40',
                height: '40',
                viewBox: '0 0 40 40',
                xmlns: 'http://www.w3.org/2000/svg',
            }, [
                svg('rect', {
                    width: '40',
                    height: '40',
                    rx: '20',
                    fill: 'currentColor',
                }),
                svg('path.player-bar__play-icon-el', {
                    d: 'M27.0385 21.4138C26.9679 21.4862 26.7012 21.7962 26.4528 22.0512C24.9963 23.655 21.197 26.28 19.2085 27.0813C18.9065 27.21 18.143 27.4825 17.735 27.5C17.3441 27.5 16.9715 27.41 16.6159 27.2275C16.1727 26.9725 15.8171 26.5713 15.6223 26.0975C15.4968 25.7688 15.302 24.785 15.302 24.7675C15.1072 23.6913 15 21.9425 15 20.01C15 18.1688 15.1072 16.4913 15.2667 15.3988C15.2849 15.3812 15.4798 14.1588 15.6929 13.74C16.0838 12.975 16.8473 12.5 17.6644 12.5H17.735C18.2672 12.5187 19.3863 12.9938 19.3863 13.0113C21.2677 13.8138 24.9793 16.31 26.471 17.9688C26.471 17.9688 26.8911 18.395 27.0738 18.6613C27.3587 19.0437 27.5 19.5175 27.5 19.9913C27.5 20.52 27.3405 21.0125 27.0385 21.4138Z',
                    fill: 'currentColor'
                })
            ]),
            svg('svg.player-bar__pause-icon.player-bar__icon-hidden', {
                'aria-hidden': true,
                width: '40',
                height: '40',
                viewBox: '0 0 40 40',
                fill: 'currentColor',
                xmlns: 'http://www.w3.org/2000/svg',
            }, [
                svg('rect', {
                    width: '40',
                    height: '40',
                    rx: '20',
                    fill: 'currentColor',
                }),
                svg('rect.player-bar__pause-icon-el', {
                    x: '10',
                    y: '10',
                    width: '5',
                    height: '20',
                    rx: '2'
                }),
                svg('rect.player-bar__pause-icon-el', {
                    x: '25',
                    y: '10',
                    width: '5',
                    height: '20',
                    rx: '2'
                })
            ]),
            { type: 'button' }
        );

        const skipForwardBtnEl = el('button.player-bar__skip-forward-btn.btn-icon', svg('svg.player-bar__icon.player-bar__icon--forward', {
            'aria-hidden': true,
            width: '16',
            height: '16',
            viewBox: '0 0 16 16',
            xmlns: 'http://www.w3.org/2000/svg',
        }, [
            svg('path', {
                d: 'M3.5 2C3.63261 2 3.75978 2.05268 3.85355 2.14645C3.94732 2.24022 4 2.36739 4 2.5V7.10846L11.4786 2.53821C11.6302 2.44558 11.8037 2.39501 11.9813 2.39169C12.1589 2.38838 12.3342 2.43244 12.4892 2.51934C12.6441 2.60624 12.7731 2.73285 12.8629 2.88615C12.9527 3.03944 13 3.21389 13 3.39154V12.6085C12.9999 12.7861 12.9526 12.9605 12.8628 13.1137C12.773 13.267 12.644 13.3936 12.489 13.4805C12.3341 13.5674 12.1588 13.6114 11.9812 13.6081C11.8036 13.6048 11.6301 13.5543 11.4785 13.4618L4 8.89151V13.5C4 13.6326 3.94732 13.7598 3.85355 13.8536C3.75979 13.9473 3.63261 14 3.5 14C3.36739 14 3.24021 13.9473 3.14645 13.8536C3.05268 13.7598 3 13.6326 3 13.5V2.5C3 2.36739 3.05268 2.24022 3.14645 2.14645C3.24022 2.05268 3.36739 2 3.5 2Z',
                fill: 'currentColor'
            })
        ]), { type: 'button' });
        const repeatBtnEl = el('button.player-bar__repeat-btn.btn-icon', svg('svg.player-bar__icon', {
            'aria-hidden': true,
            width: '16',
            height: '16',
            viewBox: '0 0 16 16',
            xmlns: 'http://www.w3.org/2000/svg',
        }, [
            svg('path', {
                d: 'M2 8.50001C2.13261 8.5 2.25978 8.44732 2.35355 8.35356C2.44731 8.25979 2.49999 8.13262 2.5 8.00001C2.50105 7.07207 2.87013 6.18244 3.52628 5.52629C4.18243 4.87014 5.07206 4.50106 6 4.50001H12.7929L12.1464 5.14646C12.0527 5.24024 12 5.36742 12 5.50003C12 5.63264 12.0527 5.75982 12.1465 5.85359C12.2402 5.94735 12.3674 6.00003 12.5 6.00002C12.6326 6.00002 12.7598 5.94733 12.8536 5.85356L14.3536 4.35356C14.3553 4.35188 14.3567 4.34999 14.3583 4.34828C14.3681 4.33824 14.3777 4.32792 14.3866 4.31706C14.3918 4.31065 14.3964 4.3039 14.4013 4.29731C14.4061 4.29084 14.4112 4.28453 14.4157 4.27781C14.4208 4.27015 14.4252 4.26222 14.4299 4.25438C14.4336 4.24821 14.4374 4.24223 14.4408 4.23591C14.4451 4.22797 14.4487 4.21983 14.4525 4.21174C14.4556 4.20503 14.459 4.19844 14.4618 4.19154C14.4651 4.1837 14.4677 4.1757 14.4706 4.16774C14.4732 4.16029 14.4761 4.15297 14.4784 4.14537C14.4808 4.13734 14.4826 4.12916 14.4846 4.12104C14.4865 4.11336 14.4887 4.10572 14.4903 4.09788C14.4922 4.08845 14.4933 4.0789 14.4946 4.06935C14.4956 4.06272 14.4968 4.05622 14.4975 4.04951C14.5008 4.01659 14.5008 3.98343 14.4975 3.95051C14.4968 3.9438 14.4956 3.9373 14.4946 3.93067C14.4933 3.92112 14.4922 3.91157 14.4903 3.90214C14.4887 3.8943 14.4865 3.88667 14.4846 3.87898C14.4826 3.87086 14.4808 3.86268 14.4784 3.85466C14.4761 3.84706 14.4732 3.83973 14.4706 3.83229C14.4677 3.82432 14.4651 3.81633 14.4618 3.80848C14.459 3.80159 14.4556 3.79499 14.4525 3.78828C14.4487 3.78019 14.4451 3.77204 14.4408 3.76411C14.4374 3.75779 14.4336 3.75181 14.4299 3.74565C14.4252 3.7378 14.4208 3.72987 14.4157 3.72221C14.4112 3.71549 14.4061 3.70918 14.4013 3.70271C14.3964 3.69612 14.3918 3.68937 14.3866 3.68296C14.3775 3.67189 14.3678 3.66139 14.3578 3.65113C14.3563 3.64964 14.3551 3.64796 14.3536 3.64647L12.8536 2.14647C12.7598 2.05269 12.6326 2.00001 12.5 2C12.3674 1.99999 12.2402 2.05267 12.1465 2.14643C12.0527 2.2402 12 2.36738 12 2.49999C12 2.6326 12.0527 2.75978 12.1464 2.85356L12.7929 3.50001H6C4.80694 3.50135 3.66313 3.97589 2.8195 4.81951C1.97588 5.66314 1.50134 6.80695 1.5 8.00001C1.50001 8.13262 1.55269 8.25979 1.64645 8.35356C1.74022 8.44732 1.86739 8.5 2 8.50001Z',
                fill: 'currentColor'
            }),
            svg('path', {
                d: 'M13.9999 7.5C13.8673 7.50001 13.7402 7.55269 13.6464 7.64645C13.5526 7.74022 13.5 7.86739 13.4999 8C13.4989 8.92794 13.1298 9.81757 12.4737 10.4737C11.8175 11.1299 10.9279 11.499 9.99995 11.5H3.20705L3.85352 10.8535C3.94729 10.7598 3.99996 10.6326 3.99996 10.5C3.99995 10.3674 3.94727 10.2402 3.85349 10.1464C3.75972 10.0527 3.63254 9.99998 3.49993 9.99999C3.36731 9.99999 3.24014 10.0527 3.14637 10.1465L1.64637 11.6465C1.64487 11.6479 1.64362 11.6496 1.64214 11.6511C1.63216 11.6614 1.62246 11.6719 1.61338 11.683C1.60812 11.6894 1.60352 11.6961 1.59863 11.7027C1.5938 11.7092 1.58878 11.7155 1.58428 11.7222C1.57916 11.7299 1.5747 11.7378 1.57005 11.7456C1.56638 11.7518 1.56252 11.7578 1.55914 11.7641C1.55488 11.772 1.55128 11.7802 1.54748 11.7883C1.54433 11.795 1.54096 11.8016 1.53811 11.8085C1.53486 11.8163 1.53223 11.8243 1.5294 11.8323C1.52674 11.8397 1.52387 11.847 1.52157 11.8546C1.51914 11.8627 1.51734 11.8708 1.51533 11.879C1.5134 11.8867 1.51122 11.8943 1.50967 11.9021C1.50779 11.9116 1.50663 11.9211 1.50532 11.9307C1.50439 11.9373 1.50311 11.9438 1.50245 11.9505C1.49918 11.9834 1.49918 12.0166 1.50245 12.0495C1.50311 12.0562 1.50439 12.0627 1.50532 12.0693C1.50663 12.0789 1.50779 12.0884 1.50967 12.0979C1.51122 12.1057 1.5134 12.1133 1.51533 12.121C1.51734 12.1292 1.51914 12.1373 1.52157 12.1454C1.52387 12.153 1.52674 12.1603 1.5294 12.1677C1.53223 12.1757 1.53486 12.1837 1.53811 12.1915C1.54096 12.1984 1.54433 12.205 1.54748 12.2117C1.55128 12.2198 1.55488 12.228 1.55914 12.2359C1.56252 12.2422 1.56639 12.2482 1.57005 12.2544C1.5747 12.2622 1.57915 12.2701 1.58428 12.2778C1.58878 12.2845 1.5938 12.2908 1.59863 12.2973C1.60352 12.3039 1.60812 12.3106 1.61338 12.317C1.62229 12.3279 1.63183 12.3382 1.64161 12.3483C1.64327 12.35 1.64468 12.3519 1.64637 12.3535L3.14637 13.8535C3.1928 13.9 3.24792 13.9368 3.30858 13.9619C3.36924 13.9871 3.43426 14 3.49993 14C3.56559 14 3.63061 13.9871 3.69127 13.962C3.75194 13.9368 3.80706 13.9 3.85349 13.8536C3.89993 13.8071 3.93676 13.752 3.96189 13.6914C3.98702 13.6307 3.99996 13.5657 3.99996 13.5C3.99996 13.4344 3.98703 13.3693 3.96191 13.3087C3.93678 13.248 3.89995 13.1929 3.85352 13.1465L3.20705 12.5H9.99995C11.193 12.4987 12.3368 12.0241 13.1804 11.1805C14.0241 10.3369 14.4986 9.19306 14.4999 8C14.4999 7.86739 14.4473 7.74022 14.3535 7.64645C14.2597 7.55269 14.1326 7.50001 13.9999 7.5Z',
                fill: 'currentColor'
            })
        ]), { type: 'button' });
        const centerTopEl = el('.player-bar__center-top', shuffleBtnEl, skipBackBtnEl, playBtnEl, skipForwardBtnEl, repeatBtnEl);
        const currentTimecodeEl = el('span.player-bar__timecode.player-bar__timecode--current', '0:00');
        const progressBar = el('.player-bar__progress-bar');
        const progressBarWrapper = el('.player-bar__progress-bar-wrapper', progressBar);
        const totalTimecode = el('span.player-bar__timecode.player-bar__timecode--total', duration);
        const centerBottomEl = el('.player-bar__center-bottom', currentTimecodeEl, progressBarWrapper, totalTimecode);
        const centerEl = el('.player-bar__center', centerTopEl, centerBottomEl);
        const volumeBtnEl = el('button.player-bar__volume-btn.btn-icon', svg('svg.player-bar__icon', {
            'aria-hidden': true,
            width: '16',
            height: '16',
            viewBox: '0 0 16 16',
            fill: 'none',
            xmlns: 'http://www.w3.org/2000/svg',
        }, [
            svg('path', {
                d: 'M5 10.5H2C1.86739 10.5 1.74021 10.4473 1.64645 10.3536C1.55268 10.2598 1.5 10.1326 1.5 10V6C1.5 5.86739 1.55268 5.74021 1.64645 5.64645C1.74021 5.55268 1.86739 5.5 2 5.5H5L9.5 2V14L5 10.5Z',
                stroke: 'currentColor',
                strokeLinecap: 'round',
                strokeLinejoin: 'round'

            }),
            svg('path', {
                d: 'M5 5.5V10.5',
                stroke: 'currentColor',
                strokeLinecap: 'round',
                strokeLinejoin: 'round'
            }),
            svg('path', {
                d: 'M11.9124 6.58582C12.0981 6.77153 12.2454 6.99201 12.3459 7.23466C12.4464 7.47731 12.4981 7.73739 12.4981 8.00003C12.4981 8.26267 12.4464 8.52274 12.3459 8.7654C12.2454 9.00805 12.0981 9.22853 11.9124 9.41424',
                stroke: 'currentColor',
                strokeLinecap: 'round',
                strokeLinejoin: 'round'
            })
        ]), { type: 'button' });
        const volumeBar = el('.player-bar__volume-bar');
        const rightEl = el('.player-bar__right', volumeBtnEl, volumeBar);

        this.playBtnEl = playBtnEl;
        this.progressBarEl = progressBar;
        this.currentTimeEl = currentTimecodeEl;
        playBtnEl.addEventListener('click', () => this.togglePlay());
        skipBackBtnEl.addEventListener('click', () => this.skipBack());
        skipForwardBtnEl.addEventListener('click', () => this.skipForward());

        progressBarWrapper.addEventListener('click', (e) => {
            if (this.currentTrack?.audio) {
                const rect = progressBarWrapper.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                this.currentTrack.audio.currentTime = percent * this.currentTrack.duration;
            }
        });

        volumeBar.addEventListener('click', (e) => {
            if (this.currentTrack?.audio) {
                const rect = volumeBar.getBoundingClientRect();
                const volume = (e.clientX - rect.left) / rect.width;
                this.currentTrack.audio.volume = Math.min(1, Math.max(0, volume));
            }
        });

        this.playerBar = el('.player-bar', leftEl, centerEl, rightEl);
    };

    public setTrack(track: Track) {
        this.currentTrack = track;
        this.updateUI();
    }

    private togglePlay() {
        if (this.currentTrack) {
            this.currentTrack.play();
            this.updatePlayButton();
        }
    }

    private skipBack() {
        TrackManager.prevTrack();
    }

    private skipForward() {
        TrackManager.nextTrack();
    }

    private updateUI() {
        if (!this.currentTrack || !this.currentTrack.audio) return;

        this.currentTrack.audio.addEventListener('timeupdate', () => {
            const progress = (this.currentTrack!.audio!.currentTime / this.currentTrack!.duration) * 100;
            this.progressBarEl.style.width = `${progress}%`;
            this.currentTimeEl.textContent = this.formatTime(this.currentTrack!.audio!.currentTime);
        });

        // Добавьте эти обработчики
        this.currentTrack.audio.addEventListener('play', () => {
            this.updatePlayButton();
        });

        this.currentTrack.audio.addEventListener('pause', () => {
            this.updatePlayButton();
        });
    }

    public updatePlayButton(): void {
        const playIcon = this.playBtnEl.querySelector('.player-bar__play-icon');
        const pauseIcon = this.playBtnEl.querySelector('.player-bar__pause-icon');

        if (!playIcon || !pauseIcon) return;

        if (this.currentTrack?.isPlaying) {
            playIcon.classList.add('player-bar__icon-hidden');
            pauseIcon.classList.remove('player-bar__icon-hidden');
        } else {
            playIcon.classList.remove('player-bar__icon-hidden');
            pauseIcon.classList.add('player-bar__icon-hidden');
        }
    }

    private formatTime(seconds: number): string {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    render(): HTMLElement {
        return this.playerBar;
    }
}